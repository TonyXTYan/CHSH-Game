<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHSH Game - Presenter Dashboard</title>
    <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>
    <h1>CHSH Game - Presenter Dashboard</h1>
    <div id="connection-status-dash">Connecting...</div>

    <div class="dashboard-container">
        <div class="panel metrics">
            <div class="metric-card">
                <h3>Active Teams</h3>
                <p id="active-teams-count">0</p>
            </div>
            <div class="metric-card">
                <h3>Players</h3>
                <div class="players-grid">
                    <div>Connected:</div>
                    <div id="connected-players-count">0</div>
                    <div>Paired:</div>
                    <div id="ready-players-count">0</div>
                </div>
            </div>
            <div class="metric-card">
                <h3>Total Responses</h3>
                <p id="total-responses-count">0</p>
            </div>
            <div class="metric-card download-card">
                <h3>Download Data</h3>
                <button id="download-data-btn" onclick="downloadData()">Download CSV</button>
            </div>
            <div class="metric-card">
                <h3 id="game-control-text">Game Control</h3>
                <div class="game-controls">
                    <button id="start-game-btn" onclick="startGame()">Start Game</button>
                    <button id="pause-game-btn" onclick="togglePause()" style="display: none;">Pause</button>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Active Teams</h2>
            <table id="active-teams-table">
                <thead><tr>
                    <th>Team Name</th>
                    <th>Team ID</th>
                    <th>Player 1 SID</th>
                    <th>Player 2 SID</th>
                    <th>Current Round</th>
                    <th>Stats Sig</th>
                    <th>Trace Avg</th>
                    <th>CHSH Value</th>
                    <th>Details</th>
                </tr></thead>
                <tbody></tbody>
            </table>
            <p id="no-active-teams">No active teams yet.</p>
        </div>
        
        <!-- Modal/popup for team details -->
        <div id="team-details-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3><span>Team: </span><span id="modal-team-name"></span></h3>
                <div class="modal-section">
                    <h4>History Hashes</h4>
                    <div class="hash-container">
                        <div>
                            <strong>SHA-256:</strong>
                            <span id="modal-hash1"></span>
                        </div>
                        <div>
                            <strong>MD5:</strong>
                            <span id="modal-hash2"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h4>Correlation Matrix</h4>
                    <table id="correlation-matrix-table"></table>
                </div>
            </div>
        </div>

        <div class="panel">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;" onclick="toggleAnswerStream()">
                <h2 style="margin: 0;">Live Answer Log</h2>
                <span id="toggle-chevron" style="font-weight: bold; margin-left: 5px; font-size: 1.1em;">â–¶</span>
                <span style="margin-right: 3px;">streaming</span>
                <button id="toggle-answers-btn" onclick="event.stopPropagation(); toggleAnswerStream()" class="toggle-off" style="padding: 4px 8px; font-size: 0.9em;">OFF</button>
            </div>
            <table id="answer-log-table">
                <thead><tr><th>Timestamp</th><th>Team Name</th><th>Player SID</th><th>Round ID</th><th>Item</th><th>Answer</th></tr></thead>
                <tbody></tbody>
            </table>
            <p id="no-answers-log">No answers streamed yet.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <script src="/static/dashboard.js"></script>
</body>
</html>
